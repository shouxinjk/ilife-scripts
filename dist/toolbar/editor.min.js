var _sxdebug=!0,brokerName="请登录",brokerLogo="https://biglistoflittlethings.com/ilife-web-wx/images/icon.jpeg",loginUrl="https://sidebar.biglistoflittlethings.com/c2b/toolbar/editor";function sxInitialize(e){listenPostMessage(),listenSelectionEvent();var t="";t+='<div id="sxHideBtnDiv" class="sxinfo" style="position:fixed;z-index:2147483647;top:0px;right:0px;background-color:#fff;width:50px;height:20px;border-radius:5px;display:none">',t+='<div style="line-height:22px;color:grey;background-color:#fff">隐藏</div>',t+="</div>",t+='<div id="sxShowBtnDiv" class="sxinfo" style="position:fixed;z-index:2147483647;top:0px;right:0;background-color:#fff;width:44px;height:150px;border-radius:5px;padding-left:12px;display:flex">',t+='<div class="info-general">',t+='<img class="general-icon" src="'+brokerLogo+'" width="30" height="30"/>',t+="</div>",t+='<div class="info-detail" style="text-align:left">',t+='<div class="info-text info-blank" style="color:#000;font-size:14px;height:100px;background-color:#fff">内<br/>容<br/>助<br/>手</div>',t+="</div>",e.append(t);var o="";o+="<div id='sxDiv' style='position:fixed;z-index:2147483646;top:0px;right:0px;background-color:#fff;min-width:500px;width:500px;height:100%;border-radius:5px;display:none;border-left:1px solid silver;'>",o+='<div id="brokerInfoDiv" class="sxinfo" style="background-image:none;display:flex;">',o+='<div class="info-general">',o+='<img id="broker-logo" class="general-icon" src="'+brokerLogo+'" height="60px" style="margin:10px auto;"/>',o+="</div>",o+='<div class="info-detail" style="text-align:left">',o+='<div id="broker-name" class="info-text info-blank" style="color:#000;font-weight:bold;font-size:14px;">'+brokerName+"</div>",o+='<div class="info-text info-blank" id="brokerHint"  style="color:#000">More+内容助手</div>',o+="</div>",o+="</div>",o+='<div id="sxListDiv" class="list">',o+='<iframe id="sxListFrame" src="'+loginUrl+'" width="100%" height="400px" frameborder="0" sandbox="allow-scripts allow-same-origin">',o+="</div>",o+="</div>",e.append(o),_sxdebug&&console.log("post message to get sxToolbarStatus "),document.getElementById("sxListFrame").contentWindow.postMessage({action:"checkToolbarStatus"},"*");var n=$("#sxDiv").height()-$("#brokerInfoDiv").height();$("#sxListFrame").height(n);try{showToolbar(JSON.parse(localStorage.getItem("sxToolbarStatus")))}catch(e){}try{var i=JSON.parse(localStorage.getItem("sxUserInfo"));_sxdebug&&console.log("sxUserInfo",i),updateToolbarInfo(i)}catch(e){_sxdebug&&console.log("failed parse userInfo",localStorage.getItem("sxUserInfo"),e)}$("#sxHideBtnDiv").click(function(e){$("#sxHideBtnDiv").css("display","none"),$("#sxShowBtnDiv").css("display","block"),$("#sxDiv").css("display","none"),localStorage.setItem("sxToolbarStatus",JSON.stringify({show:!1}))}),$("#sxShowBtnDiv").click(function(e){$("#sxShowBtnDiv").css("display","none"),$("#sxHideBtnDiv").css("display","block"),$("#sxDiv").css("display","block"),localStorage.setItem("sxToolbarStatus",JSON.stringify({show:!0}))})}function showToolbar(e){e&&(e.show?($("#sxShowBtnDiv").css("display","none"),$("#sxHideBtnDiv").css("display","block"),$("#sxDiv").css("display","block")):($("#sxShowBtnDiv").css("display","block"),$("#sxHideBtnDiv").css("display","none"),$("#sxDiv").css("display","none")))}function updateToolbarInfo(e){if(e){_sxdebug&&console.log("update toolbar with userInfo.",e);var t="Hi,"+(e.username?e.username:"")+(e.sxBrokerOrgnization&&e.sxBrokerOrgnization.trim().length>0?"("+e.sxBrokerOrgnization+")":"");t+="&nbsp;<a href='#' style='font-size:12px;color:silver;text-decoration:none' id='sxChangeBroker' alt='切换账户'><span style='width:12px;height:12px;'>⇌</span></a>",$("#broker-name").html(t),e.avatar&&$("#broker-logo").attr("src",e.avatar),$("#sxChangeBroker").click(function(e){_sxdebug&&console.log("try to remove broker info."),document.getElementById("sxListFrame").contentWindow.postMessage({action:"logout"},"*"),$("#broker-name").html(brokerName),$("#broker-logo").attr("src",brokerLogo),clearInterval(timer),$("#sxListFrame").attr("src",loginUrl)})}}function listenSelectionEvent(){createSxPanel(),addSelectListener();var e=null;(e=document.getElementById("ueditor_0"))&&(_sxdebug&&console.log("got iframe document",e),addSelectListener(e.contentDocument));(e=document.getElementById("baidu_editor_0"))&&(_sxdebug&&console.log("got iframe document",e),addSelectListener(e.contentDocument));(e=document.getElementById("content-mfwediter-iframe"))&&(_sxdebug&&console.log("got iframe document",e),addSelectListener(e.contentDocument))}function addSelectListener(e=document){document.addEventListener?e.addEventListener("selectionchange",t=>{_sxdebug&&console.log("on selection change"),actionOnSelection(e)}):e.onselectionchange=(t=>{_sxdebug&&console.log("on selection change"),actionOnSelection(e)})}function createSxPanel(e=document){var t=$(e).find("body");_sxdebug&&console.log("got body El",t);var o='\n            <div id="_sxPanel" style="border:1px solid silver;display:none;position:absolute;z-index:9999999;width:400px;height:320px;background-color:#e2e3e2;">\n                <div style="line-height:32px;width:100%;background-color:#aae47c;display:flex;flex-direction:row;align-items:center;">\n                    <div style="width:50%;">&nbsp;&nbsp;More+智能助手</div>\n                    <div style="width:50%;text-align:right;float:right;">\n                        <div style="width:100%;display:none;text-align:right;float:right;vertical-align:middle;" id="_sxImgLoading">\n                            <img src="https://www.biglistoflittlethings.com/ilife-web-wx/images/loading.gif" style="display: inline-block; vertical-align: middle;"/>\n                        </div>\n                    </div>\n                </div>\n                <textarea id="_sxGenContent" style="height:254px;line-height:24px;border:0;border:none;width:100%;">\n\n                </textarea>\n                <div style="line-height:32px;width:100%;background-color:#ffbcb3;text-align:right;__toutiao__wechat__ctrip__135eidtor__xiumieditor">\n                    <button id="_sxBtnChange" style="padding:2px 5px;__135btn__xiumibtn">改写</button>\n                    <button id="_sxBtnAppend" style="padding:2px 5px;__135btn__xiumibtn">续写</button>\n                    <button id="_sxBtnExtend" style="padding:2px 5px;__135btn__xiumibtn">扩写</button>\n                    <button id="_sxBtnShrink" style="padding:2px 5px;__135btn__xiumibtn">缩写</button>                \n                    <button id="_sxBtnReplaceContent" style="padding:2px 5px;__135btn__xiumibtn">插入/替换</button>&nbsp;&nbsp;\n                </div>\n            </div>\n        ';o=window.location.href.indexOf("mp.toutiao.com")>0?o.replace(/__toutiao/g,"margin-top:-4px;"):o.replace(/__toutiao/g,""),o=window.location.href.indexOf("mp.weixin.qq.com")>0?o.replace(/__wechat/g,"margin-top:2px;"):o.replace(/__wechat/g,""),o=window.location.href.indexOf("you.ctrip.com")>0?o.replace(/__ctrip/g,"margin-top:-4px;"):o.replace(/__ctrip/g,""),o=window.location.href.indexOf("www.135editor.com")>0?(o=o.replace(/__135btn/g,"background-color:transparent;border:0;margin-top:4px;")).replace(/__135eidtor/g,"margin-top:-6px;"):(o=o.replace(/__135btn/g,"")).replace(/__135eidtor/g,""),o=window.location.href.indexOf("xiumi.us")>0?(o=o.replace(/__xiumibtn/g,"background-color:transparent;border:0;margin-top:4px;")).replace(/__xiumieditor/g,"margin-top:-6px;"):(o=o.replace(/__xiumibtn/g,"")).replace(/__xiumieditor/g,""),$(e).find("body").append(o),$("#_sxBtnChange").click(function(){_sxdebug&&console.log("try aigc change..."),localStorage.setItem("sxCurrentContent",$("#_sxGenContent").val()),$("#_sxImgLoading").css({display:"block"}),document.getElementById("sxListFrame").contentWindow.postMessage({action:"sxAigcAction",data:{prompt:"改写",content:$("#_sxGenContent").val()}},"*")}),$("#_sxBtnAppend").click(function(){_sxdebug&&console.log("try aigc append..."),localStorage.setItem("sxCurrentContent",$("#_sxGenContent").val()),$("#_sxImgLoading").css({display:"block"}),document.getElementById("sxListFrame").contentWindow.postMessage({action:"sxAigcAction",data:{prompt:"续写",content:$("#_sxGenContent").val()}},"*")}),$("#_sxBtnExtend").click(function(){_sxdebug&&console.log("try aigc extend..."),localStorage.setItem("sxCurrentContent",$("#_sxGenContent").val()),$("#_sxImgLoading").css({display:"block"}),document.getElementById("sxListFrame").contentWindow.postMessage({action:"sxAigcAction",data:{prompt:"扩写",content:$("#_sxGenContent").val()}},"*")}),$("#_sxBtnShrink").click(function(){_sxdebug&&console.log("try aigc shrink..."),localStorage.setItem("sxCurrentContent",$("#_sxGenContent").val()),$("#_sxImgLoading").css({display:"block"}),document.getElementById("sxListFrame").contentWindow.postMessage({action:"sxAigcAction",data:{prompt:"缩写",content:$("#_sxGenContent").val()}},"*")})}function checkElement(e){return _sxdebug&&console.log("check element",e),e.getAttribute("class")&&e.getAttribute("class").indexOf("ProseMirror")>-1?(_sxdebug&&console.log("got element attribute",e.getAttribute("class")),!0):e.getAttribute("class")&&e.getAttribute("class").indexOf("rich_media_content")>-1?(_sxdebug&&console.log("got element attribute",e.getAttribute("class")),!0):e.getAttribute("id")&&e.getAttribute("id").indexOf("post-textarea")>-1?(_sxdebug&&console.log("got element id",e.getAttribute("id")),!0):e.getAttribute("contenteditable")&&e.getAttribute("contenteditable").indexOf("true")>-1?(_sxdebug&&console.log("got element body"),!0):e.getAttribute("class")&&e.getAttribute("class").indexOf("ck-editor__editable")>-1?(_sxdebug&&console.log("got element id",e.getAttribute("class")),!0):!!(e.getAttribute("class")&&e.getAttribute("class").indexOf("view")>-1)&&(_sxdebug&&console.log("got element attribute",e.getAttribute("class")),!0)}function actionOnSelection(e=document){const t=e.getSelection();var o=t.getRangeAt(0);const n=o.getBoundingClientRect(),i=t.toString();_sxdebug&&console.log("action on selection",t,o,n,i),_sxdebug&&console.log("check selection isvalid",$(t.anchorNode).parents());var s=!1;$.each($(t.anchorNode).parents(),function(e,t){_sxdebug&&console.log("check parent element",t),checkElement(t)&&(s=!0)});var l=$("#_sxPanel"),a=$(document).scrollTop()||$(window).scrollTop();_sxdebug&&console.log("sxPanel selection offset",n.top,a),$("#_sxGenContent").val(i),$("#_sxBtnReplaceContent").unbind("click"),$("#_sxBtnReplaceContent").click(function(){var e=localStorage.getItem("sxCurrentContent");_sxdebug&&console.log("got current content",e),o.deleteContents(),_sxdebug&&console.log("content deleted.",o,t);var n=$("<p>"+e+"</p>");o.insertNode(n[0]),o.detach(),l.css({display:"none"})}),localStorage.setItem("sxCurrentContent",i),localStorage.setItem("sxConversationId","");var c,r=0,d=0;(c=$("#edui1_iframeholder"))&&c.offset()&&(_sxdebug&&console.log("got iframe offset",c.offset()),r=c.offset().left-95,d=c.offset().top,a=0,_sxdebug&&console.log("sxPanel iframe offset",r,d)),(c=$("#edui22_iframeholder"))&&c.offset()&&(_sxdebug&&console.log("got iframe offset",c.offset()),r=c.offset().left,d=c.offset().top,a=0,_sxdebug&&console.log("sxPanel iframe offset",r,d)),s&&i&&i.trim().length>0?(_sxdebug&&console.log("show sxpanel",s,i),l.css({display:"block",top:d+n.top+a+n.height+5+"px",left:r+n.left+"px"})):(_sxdebug&&console.log("hide sxpanel",s,i),l.css({display:"none",top:0,left:0}))}function listenPostMessage(){var e=window.addEventListener?"addEventListener":"attachEvent";(0,window[e])("attachEvent"==e?"onmessage":"message",function(e){var t=e[e.message?"message":"data"];if(_sxdebug&&console.log("got message from child window.",t),t&&"sxSendMsg"==t.action&&t.content&&t.content.trim().length>0&&(_sxdebug&&console.log("action: send msg",t.content),$("div.simulate-textarea").text(t.content),_sxdebug&&console.log("got btn.",$(".chat_area-button button[title='发送消息']"))),t&&"sxLogin"==t.action&&t.data&&(_sxdebug&&console.log("action: change toolbar status",t.data),t.data.userInfo&&(localStorage.setItem("sxUserInfo",JSON.stringify(t.data.userInfo)),updateToolbarInfo(t.data.userInfo),$("#sxListFrame").attr("src",loginUrl))),t&&"sxToolbarStatus"==t.action&&t.data&&(_sxdebug&&console.log("action: change toolbar status",t.data),t.data.userInfo&&(localStorage.setItem("sxUserInfo",JSON.stringify(t.data.userInfo)),updateToolbarInfo(t.data.userInfo))),t&&"sxRediret"==t.action&&t.url&&t.url.trim().length>0&&(_sxdebug&&console.log("action: redirect",t.url),window.open(t.url)),t&&"sxSopCustomer"==t.action&&t.sop&&(_sxdebug&&console.log("action: sxSopCustomer",t.sop),timeoutAutoReply=t.sop.threshold?t.sop.threshold:180,timeoutNotify=timeoutAutoReply-180>0?timeoutAutoReply-180:timeoutAutoReply/2,loopCustomerMsgs()),t&&"sxPublishContent"==t.action&&t.content&&t.content.trim().length>0&&(_sxdebug&&console.log("action: sxPublishContent ",t),setSxContent(t.title,t.content)),t&&"sxAppendContent"==t.action&&t.content&&t.content.trim().length>0&&(_sxdebug&&console.log("action: sxAppendContent ",t),appendSxContent(t.content)),t&&"sxAppendImage"==t.action&&t.url&&t.url.trim().length>0&&(_sxdebug&&console.log("action: sxAppendImage ",t),appendSxImage(t.url)),t&&"sxAigcAction"==t.action){_sxdebug&&console.log("action: sxAigcAction ",t),$("#_sxImgLoading").css({display:"none"});var o=localStorage.getItem("sxCurrentContent");"续写"===t.data.prompt?o+=t.data.content:o=t.data.content,localStorage.setItem("sxCurrentContent",o),$("#_sxGenContent").val(o)}},!1)}function setSxContent(e,t){if(window.location.href.indexOf("mp.toutiao.com")>0)$(".ProseMirror").empty(),$(".ProseMirror").append(t),$(".editor-title textarea").val(e),$(".editor-title pre").text(e),$(".editor-title textarea").val(e);else if(window.location.href.indexOf("mp.weixin.qq.com")>0){(o=$(document.getElementById("ueditor_0").contentDocument).find("body")).empty(),o.append(t),$("#title").val(e)}else if(window.location.href.indexOf("creator.xiaohongshu.com")>0)$("#post-textarea").empty(),$("#post-textarea").append(t),$(".titleInput input").val(e);else if(window.location.href.indexOf("you.ctrip.com/TravelSite/Member/EditClassicTravel")>0){(o=$(document.getElementById("baidu_editor_0").contentDocument).find("body")).empty(),o.append(t),$("#title").val(e)}else if(window.location.href.indexOf("you.ctrip.com/TravelSite/Member/EditNewTravel")>0){(o=$(document.getElementById("ueditor_0").contentDocument).find("body")).empty(),o.append(t),$(".yj_write_title").val(e)}else if(window.location.href.indexOf("you.ctrip.com/TravelSite/Member/EditClassicTravel")>0){(o=$(document.getElementById("content-mfwediter-iframe").contentDocument).find("body")).empty(),o.append(t),$("#title").val(e)}else if(window.location.href.indexOf("card.weibo.com")>0)$(".ck-editor__editable").empty(),$(".ck-editor__editable").append(t),$(".title_ipt textarea").val(e);else if(window.location.href.indexOf("www.135editor.com")>0){var o;(o=$(document.getElementById("ueditor_0").contentDocument).find("body")).empty(),o.append(t)}else window.location.href.indexOf("xiumi.us")>0&&($("div[tn-cell='txt1']").html("<p></p>"),$("div[tn-cell='txt1']").append(t),$(".tn-meta-panel input.title").val(e))}function onLoginSuccess(e){console.log("got onLoginSuccess callback.",e)}function appendSxContent(e){if(window.location.href.indexOf("mp.toutiao.com")>0)document.selection&&document.selection.createRange?(console.log("try insert to selection.",e),(o=document.selection.createRange()).collapse(!1),o.pasteHTML(e)):(console.log("try append.",e),$(".ProseMirror").append(e));else if(window.location.href.indexOf("mp.weixin.qq.com")>0){if((t=document.getElementById("ueditor_0").contentDocument).selection&&t.selection.createRange)console.log("try insert to selection.",e),(o=t.selection.createRange()).collapse(!1),o.pasteHTML(e);else console.log("try append.",e),$(t).find("body").append(e)}else if(window.location.href.indexOf("creator.xiaohongshu.com")>0){if(document.selection&&document.selection.createRange)console.log("try insert to selection.",e),(o=document.selection.createRange()).collapse(!1),o.pasteHTML(e);else console.log("try append.",e),$("#post-textarea").append(e)}else if(window.location.href.indexOf("you.ctrip.com/TravelSite/Member/EditClassicTravel")>0){if((t=document.getElementById("baidu_editor_0").contentDocument).selection&&t.selection.createRange)console.log("try insert to selection.",e),(o=t.selection.createRange()).collapse(!1),o.pasteHTML(e);else console.log("try append.",e),$(t).find("body").append(e)}else if(window.location.href.indexOf("you.ctrip.com/TravelSite/Member/EditNewTravel")>0){if((t=document.getElementById("ueditor_0").contentDocument).selection&&t.selection.createRange)console.log("try insert to selection.",e),(o=t.selection.createRange()).collapse(!1),o.pasteHTML(e);else console.log("try append.",e),$(t).find("body").append(e)}else if(window.location.href.indexOf("www.mafengwo.cn/ginfo/create")>0){if((t=document.getElementById("content-mfwediter-iframe").contentDocument).selection&&t.selection.createRange)console.log("try insert to selection.",e),(o=t.selection.createRange()).collapse(!1),o.pasteHTML(e);else console.log("try append.",e),$(t).find("body").append(e)}else if(window.location.href.indexOf("card.weibo.com")>0){if(document.selection&&document.selection.createRange)console.log("try insert to selection.",e),(o=document.selection.createRange()).collapse(!1),o.pasteHTML(e);else console.log("try append.",e),$(".ck-editor__editable").append(e)}else if(window.location.href.indexOf("www.135editor.com")>0){var t;if((t=document.getElementById("ueditor_0").contentDocument).selection&&t.selection.createRange)console.log("try insert to selection.",e),(o=t.selection.createRange()).collapse(!1),o.pasteHTML(e);else console.log("try append.",e),$(t).find("body").append(e)}else if(window.location.href.indexOf("xiumi.us")>0){var o;if(document.selection&&document.selection.createRange)console.log("try insert to selection.",e),(o=document.selection.createRange()).collapse(!1),o.pasteHTML(e);else console.log("try append.",e),$("div[tn-cell='txt1']").append(e)}}function appendSxImage(e){var t='<p><img src="__imgsrc"/></p>';t=t.replace(/__imgsrc/g,e),_sxdebug&&console.log("try insert image.",t),appendSxContent(t)}var timerInterval=300,timeoutNotify=120,timeoutAutoReply=180,sxTimers=new Array,companyName="",testSent=!1,timer=null;function loopCustomerMsgs(){var e=(new Date).getTime();timer=setInterval(function(){$(".im_friend-queue li>a").each(function(){var t={channelName:"vBooking",channelType:"ota",contentType:"text",toUser:$(this).find("strong.nick").text(),fromUser:$(this).find("em.message-name").text(),msg:$(this).find("em.newmessage").text(),time:$(this).find("span.date").text(),startTimeout:e,notifyTimeout:e+1e3*timeoutNotify,autoReplyTimeout:e+1e3*timeoutAutoReply};testSent||(document.getElementById("sxListFrame").contentWindow.postMessage({action:"sendAutoReply",data:t},"*"),testSent=!0);var o=sxTimers.findIndex(e=>e.toUser==t.toUser);if(o>=0){var n=sxTimers[o];n.notifyTimeout&&n.notifyTimeout>=e-timerInterval?(_sxdebug&&console.log("msg timeout notify.",n),document.getElementById("sxListFrame").contentWindow.postMessage({action:"sendNotify",data:t},"*"),n.notifyTimeout=null,sxTimers.splice(o,1,n)):n.autoReplyTimeout&&n.autoReplyTimeout>=e-timerInterval?(_sxdebug&&console.log("msg timeout autoreply.",n),$("div.simulate-textarea").text("auto reply test"),document.getElementById("sxListFrame").contentWindow.postMessage({action:"sendAutoReply",data:t},"*"),n.notifyTimeout=null,n.autoReplyTimeout=null,sxTimers.splice(o,1,n)):_sxdebug&&console.log("timer countinue.",n)}else t.fromUser!=companyName?sxTimers.push(t):(_sxdebug&&console.log("clear timer",t),sxTimers.splice(o,1))})},timerInterval)}