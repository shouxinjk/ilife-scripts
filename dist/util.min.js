var _debug=!1,_meta_item=JSON.stringify({status:{crawl:"ready",sync:"pending",load:"pending",classify:"pending",measure:"pending",evaluate:"pending",index:"pending",monitize:"pending",poetize:"pending",satisify:"pending"},timestamp:{crawl:new Date}}),_sxTimer=null,_sxDataReceived=null,_sxDuration=2e3,_spi="https://data.shouxinjk.net/_db/sea/_api/document/",_spi_query="https://data.shouxinjk.net/_db/sea/_api/simple/by-example",_spi_aql="https://data.shouxinjk.net/_db/sea/_api/cursor",_spi_api="https://data.shouxinjk.net/_db/sea/",_sx_api="https://data.shouxinjk.net/ilife/a",_query={collection:"my_stuff",example:{_key:null}},_query_seed={collection:"seeds",example:{status:"new"},limit:1},_auth="Basic aWxpZmU6aWxpZmU=",_seeds=[];function isProduction(e){return!_debug}function commitUrl(e,t){__postData("seeds",e,t)}function commitData(e,t){_sxDataReceived||(_sxDataReceived=(new Date).getTime()),_sxTimer&&(new Date).getTime()-_sxDataReceived<_sxDuration&&(_debug&&console.log("try to clear timer for too frequent data commit."),clearTimeout(_sxTimer),_sxTimer=null),_sxTimer=setTimeout(function(){_debug&&console.log("commit data timer start.",e),__commitData(e,t)},_sxDuration),_sxDataReceived=(new Date).getTime()}function patchData(e,t){e._key=hex_md5(e.url),console.log("try to patch data."+e._key,e),__update(_spi+"my_stuff/"+e._key,e,t)}function __commitData(e,t){var s=_sx_api+"/mod/platformCategory/rest/mapping",o={platform:e.source,name:e.category?e.category:""};s=s+"?platform="+o.platform+"&name="+encodeURIComponent(o.name),_debug&&console.log("\n\ncheck category\n\n.[url]"+s,o);var a=new XMLHttpRequest;a.open("GET",s,!0),a.onreadystatechange=function(){if(4===a.readyState)if(a.status>=200&&a.status<400){var s=JSON.parse(a.responseText);_debug&&console.log("\n\ncheck category result.",s),s.success&&s.data&&s.data.length>0&&s.data[0].category&&(e.meta={category:s.data[0].category.id,categoryName:s.data[0].category.name},console.log("check item status.",e),e.status||(e.status={}),e.status.classify="ready",e.timestamp||(e.timestamp={}),e.timestamp.classify=new Date,_debug&&console.log("\n\n data with category info.",e)),e._key=hex_md5(e.url);const o={...e,...JSON.parse(_meta_item)};e.status&&e.status.sync&&(o.status.sync=e.status.sync),e.meta&&e.meta.category&&(o.status.classify="ready"),e.timestamp&&e.timestamp.classify&&(o.timestamp.classify=e.timestamp.classify),_debug&&console.log("try to send local storage",JSON.stringify(o).length,o),__postMessage(o),console.log("trigger data commit.",o),__postData("my_stuff",o,t)}else _debug&&console.log(JSON.parse(a.responseText));else console.log("check category mapping error.")},a.onerror=function(){e._key=hex_md5(e.url);const s={...e,...JSON.parse(_meta_item)};e.status&&e.status.sync&&(s.status.sync=e.status.sync),e.meta&&e.meta.category&&(s.status.classify="ready"),e.timestamp&&e.timestamp.classify&&(s.timestamp.classify=e.timestamp.classify),_debug&&console.log("try to send local storage",JSON.stringify(s).length,s),__postMessage(s),_debug&&console.log("trigger data commit.",s),__postData("my_stuff",s,t)};try{a.send()}catch(e){_debug&&console.log("Error while checking data if exists."+e)}}function commitBrokerSeed(e,t){__update(_spi+"broker_seeds/"+e._key,e,t)}function commitBrokerSeeds(e,t){__ajax(_spi_aql,e,"POST",t)}function commitPropValues(e,t){__ajax(_spi+"prop_values",e,"POST",t)}function fullUrl(e){var t=document.createElement("a");return t.href=e,t.href}function __postData(e,t,s){_debug&&console.log("check if data exists.[spi.url]"+_spi+e,"[data.url]"+t.url);var o=hex_md5(t.url),a=new XMLHttpRequest;_query.collection=e,_query.example._key=o,a.open("PUT",_spi_query,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization",_auth),a.setRequestHeader("Api-Key","foobar"),a.onreadystatechange=function(){if(4===a.readyState)if(a.status>=200&&a.status<400){var n=JSON.parse(a.responseText);if(_debug&&console.log("\n\ncheck result.",n,n.count),0==n.count)__create(_spi+e,t,s);else{if(t.props&&Array.isArray(t.props)){_debug&&console.log("\n\ncheck result.",n.result);var r=n.result[0].props?n.result[0].props:[],i={};for(var c in r.forEach((e,t)=>{for(var s in _debug&&console.log("foreach old props.[index]"+t,e,r),e)i[s]=e[s]}),_debug&&console.log("old props.",i),t.props.forEach((e,t)=>{for(var s in _debug&&console.log("foreach new props.[index]"+t,e,r),e)i[s]=e[s]}),_debug&&console.log("new props.",i),r=[],i){_debug&&console.log("merge props.",c,i[c]);var l={};l[c]=i[c],r.push(l)}t.props=r,_debug&&console.log("commit merged props.",t)}__update(_spi+e+"/"+o,t,s)}}else _debug&&console.log(JSON.parse(a.responseText))};try{a.send(JSON.stringify(_query))}catch(e){_debug&&console.log("Error while checking data if exists."+e)}}function __create(e,t,s){_debug&&console.log("create new document against "+e,t);var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Authorization",_auth),o.setRequestHeader("Api-Key","foobar"),o.onreadystatechange=function(){4===o.readyState&&(o.status>=200&&o.status<400&&_debug&&console.log("commit successfully. got callback",JSON.parse(o.responseText),o),s&&"function"==typeof s&&s())},o.onerror=function(e,t,s){console.log("create document error.",e,t,s)},t._key=hex_md5(t.url);const a={...t,...JSON.parse(_meta_item)};t.status&&t.status.sync&&(a.status.sync=t.status.sync),t.meta&&t.meta.category&&(a.status.classify="ready"),t.timestamp&&t.timestamp.classify&&(a.timestamp.classify=t.timestamp.classify),console.log("try to send create data.",a);try{o.send(JSON.stringify(a))}catch(e){_debug&&console.log("Error while update data to create new document."+e)}}function __update(e,t,s){_debug&&console.log("update exist document against "+e,t);var o=new XMLHttpRequest;o.open("PATCH",e,!0),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Authorization",_auth),o.setRequestHeader("Api-Key","foobar"),o.onreadystatechange=function(){4===o.readyState&&(o.status>=200&&o.status<400&&_debug&&console.log("commit successfully. got callback",JSON.parse(o.responseText),o),s&&"function"==typeof s&&s())},o.onerror=function(e,t,s){console.log("update document error.",e,t,s)};try{delNullProperty(t);const e={...t,...JSON.parse(_meta_item)};t.status&&t.status.sync&&(e.status.sync=t.status.sync),t.meta&&t.meta.category&&(e.status.classify="ready"),t.timestamp&&t.timestamp.classify&&(e.timestamp.classify=t.timestamp.classify),console.log("try to send update data.",e),o.send(JSON.stringify(e))}catch(e){_debug&&console.log("Error while update data to create new document."+e)}}function queryData(e,t){__ajax(_spi_query,e,"PUT",t)}function _querySeeds(e,t){__ajax(_spi_query,e,"PUT",t)}function __postMessage(e){_debug&&console.log("try to post message to local cookie. ",e),e.logo&&e.logo.trim().length>5||e.images&&e.images.length>0&&(e.logo=e.images[0]),document.getElementById("sxListFrame")&&(console.log("post message to  local cookie. ",JSON.stringify(e).length,e),document.getElementById("sxListFrame").contentWindow.postMessage({sxCookie:{action:"save",key:"sxPendingItem",value:e}},"*"))}function _next(){_querySeeds(_query_seed,function(e){if(e.count>0){var t=e.result[0];t.status="done",_debug&&console.log("now change seed status.",t),__postData("seeds",t,function(s){_debug&&console.log("change seed status done and try to redirect to next one",t),window.location.href=e.result[0].url})}else _debug&&console.log("no more pending url:s")})}function __ajax(e,t,s="GET",o){_debug&&console.log("AJAX "+e,t,s);var a=new XMLHttpRequest;a.open(s,e,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization",_auth),a.setRequestHeader("Api-Key","foobar"),a.onreadystatechange=function(){4===a.readyState&&a.status>=200&&a.status<400&&o&&"function"==typeof o&&o(JSON.parse(a.responseText))};try{a.send(JSON.stringify(t))}catch(e){_debug&&console.log("AJAX error."+e)}}function _getQuery(e=window.location.search){for(var t=e.length>0?e.substring(1):"",s={},o=t.length>0?t.split("&"):[],a=null,n=null,r=null,i=0;i<o.length;i++)a=o[i].split("="),n=decodeURIComponent(a[0]),r=decodeURIComponent(a[1]),n.length&&(s[n]=r);return s}function delNullProperty(e){for(let t in e)if(void 0===e[t]||null===e[t]||""===e[t])delete e[t];else if(e[t].constructor===Object)0===Object.keys(e[t]).length&&delete e[t],delNullProperty(e[t]);else if(e[t].constructor===Array)if(0===e[t].length)delete e[t];else for(let s=0;s<e[t].length;s++)void 0!==e[t][s]&&null!==e[t][s]&&""!==e[t][s]&&"{}"!==JSON.stringify(e[t][s])||(e[t].splice(s,1),s--),e[t].constructor===Object&&delNullProperty(e[t])}function getSxCookie(e){console.log("got cookie.",document.cookie);for(var t=document.cookie.split(";"),s=0;s<t.length;s++){var o=e+"=";if(0==t[s].indexOf(o))return JSON.parse(t[s].substring(o.length,t[s].length))}return{}}function addSxCookie(e,t){console.log("got cookie for adding.",document.cookie);for(var s=document.cookie.split(";"),o="",a=0;a<s.length;a++){var n=e+"=";s[a].indexOf(n)<0&&(o+=s[a]+";")}o+=e+"="+JSON.stringify(t),document.cookie=o}