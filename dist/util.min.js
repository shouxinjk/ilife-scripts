var _debug=!1,_meta_item=JSON.stringify({status:{crawl:"ready",sync:"pending",classify:"pending",measure:"pending",evaluate:"pending",index:"pending",monitize:"pending",poetize:"pending",satisify:"pending"},timestamp:{crawl:new Date}}),_spi="https://data.shouxinjk.net/_db/sea/_api/document/",_spi_query="https://data.shouxinjk.net/_db/sea/_api/simple/by-example",_spi_aql="https://data.shouxinjk.net/_db/sea/_api/cursor",_query={collection:"my_stuff",example:{_key:null}},_query_seed={collection:"seeds",example:{status:"new"},limit:1},_auth="Basic aWxpZmU6aWxpZmU=",_seeds=[];function isProduction(e){return _debug}function commitUrl(e,t){__postData("seeds",e,t)}function commitData(e,t){__postData("my_stuff",e,t)}function commitBrokerSeed(e,t){__update(_spi+"broker_seeds/"+e._key,e,t)}function commitBrokerSeeds(e,t){__ajax(_spi_aql,e,"POST",t)}function commitPropValues(e,t){__ajax(_spi+"prop_values",e,"POST",t)}function fullUrl(e){var t=document.createElement("a");return t.href=e,t.href}function __postData(t,n,o){_debug&&console.log("check if data exists.[spi.url]"+_spi+t,"[data.url]"+n.url);var s=hex_md5(n.url),a=new XMLHttpRequest;_query.collection=t,_query.example._key=s,a.open("PUT",_spi_query,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization",_auth),a.setRequestHeader("Api-Key","foobar"),a.onreadystatechange=function(){var e;4===a.readyState&&(200<=a.status&&a.status<400?(e=JSON.parse(a.responseText),_debug&&console.log("\n\ncheck result.",e,e.count),0===e.count?__create(_spi+t,n,o):__update(_spi+t+"/"+s,n,o)):_debug&&console.log(JSON.parse(a.responseText)))};try{a.send(JSON.stringify(_query))}catch(e){_debug&&console.log("Error while checking data if exists."+e)}}function __create(e,t,n){_debug&&console.log("create new document against "+e,t);var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Authorization",_auth),o.setRequestHeader("Api-Key","foobar"),o.onreadystatechange=function(){4===o.readyState&&(200<=o.status&&o.status<400&&_debug&&console.log(JSON.parse(o.responseText)),n&&"function"==typeof n&&n())},t._key=hex_md5(t.url);var s={...JSON.parse(_meta_item),...t};console.log("try to send data.",s);try{o.send(JSON.stringify(s))}catch(e){_debug&&console.log("Error while update data to create new document."+e)}}function __update(e,t,n){_debug&&console.log("update exist document against "+e,t);var o=new XMLHttpRequest;o.open("PATCH",e,!0),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Authorization",_auth),o.setRequestHeader("Api-Key","foobar"),o.onreadystatechange=function(){4===o.readyState&&(200<=o.status&&o.status<400&&_debug&&console.log(JSON.parse(o.responseText)),n&&"function"==typeof n&&n())};try{delNullProperty(t);var s={...JSON.parse(_meta_item),...t};console.log("try to send data.",s),o.send(JSON.stringify(s))}catch(e){_debug&&console.log("Error while update data to create new document."+e)}}function queryData(e,t){__ajax(_spi_query,e,"PUT",t)}function _querySeeds(e,t){__ajax(_spi_query,e,"PUT",t)}function _next(){_querySeeds(_query_seed,function(t){var n;0<t.count?((n=t.result[0]).status="done",_debug&&console.log("now change seed status.",n),__postData("seeds",n,function(e){_debug&&console.log("change seed status done and try to redirect to next one",n),window.location.href=t.result[0].url})):_debug&&console.log("no more pending url:s")})}function __ajax(e,t,n="GET",o){_debug&&console.log("AJAX "+e,t,n);var s=new XMLHttpRequest;s.open(n,e,!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Authorization",_auth),s.setRequestHeader("Api-Key","foobar"),s.onreadystatechange=function(){4===s.readyState&&200<=s.status&&s.status<400&&o&&"function"==typeof o&&o(JSON.parse(s.responseText))};try{s.send(JSON.stringify(t))}catch(e){_debug&&console.log("AJAX error."+e)}}function _getQuery(e=window.location.search){for(var t,n,o,e=0<e.length?e.substring(1):"",s={},a=0<e.length?e.split("&"):[],r=0;r<a.length;r++)t=a[r].split("="),n=decodeURIComponent(t[0]),o=decodeURIComponent(t[1]),n.length&&(s[n]=o);return s}function delNullProperty(t){for(var n in t)if(void 0===t[n]||null===t[n]||""===t[n])delete t[n];else if(t[n].constructor===Object)0===Object.keys(t[n]).length&&delete t[n],delNullProperty(t[n]);else if(t[n].constructor===Array)if(0===t[n].length)delete t[n];else for(let e=0;e<t[n].length;e++)void 0!==t[n][e]&&null!==t[n][e]&&""!==t[n][e]&&"{}"!==JSON.stringify(t[n][e])||(t[n].splice(e,1),e--),t[n].constructor===Object&&delNullProperty(t[n])}