var _debug=!0,_meta_item=JSON.stringify({status:{crawl:"ready",sync:"pending",load:"pending",classify:"pending",measure:"pending",evaluate:"pending",index:"pending",monitize:"pending",poetize:"pending",satisify:"pending"},timestamp:{crawl:new Date}}),_sxTimer=null,_sxDataReceived=null,_sxDuration=2e3,_spi="https://data.shouxinjk.net/_db/sea/_api/document/",_spi_query="https://data.shouxinjk.net/_db/sea/_api/simple/by-example",_spi_aql="https://data.shouxinjk.net/_db/sea/_api/cursor",_spi_api="https://data.shouxinjk.net/_db/sea/",_sx_api="https://data.shouxinjk.net/ilife/a",_query={collection:"my_stuff",example:{_key:null}},_query_seed={collection:"seeds",example:{status:"new"},limit:1},_auth="Basic aWxpZmU6aWxpZmU=",_seeds=[];function isProduction(e){return!_debug}function commitUrl(e,t){__postData("seeds",e,t)}function commitData(o,n){_sxDataReceived=_sxDataReceived||(new Date).getTime(),_sxTimer&&(new Date).getTime()-_sxDataReceived<_sxDuration&&(clearTimeout(_sxTimer),_sxTimer=null);var e=_sx_api+"/mod/platformCategory/rest/mapping",t={platform:o.source,name:o.category||""},e=e+"?platform="+t.platform+"&name="+t.name;_debug&&console.log("\n\ncheck category\n\n.[url]"+e,t);var s=new XMLHttpRequest;s.open("GET",e,!0),s.onreadystatechange=function(){var e,t;4===s.readyState&&(200<=s.status&&s.status<400?(e=JSON.parse(s.responseText),_debug&&console.log("\n\ncheck category result.",e),e.success&&e.data&&0<e.data.length&&e.data[0].category&&(o.meta={category:e.data[0].category.id,categoryName:e.data[0].category.name},o.status={classify:"ready"},o.timestamp={classify:new Date},_debug&&console.log("\n\n data with category info.",o)),o._key=hex_md5(o.url),t={...JSON.parse(_meta_item),...o},_debug&&console.log("try to send local storage",t),__postMessage(t),_sxTimer=setTimeout(function(){console.log("trigger data commit.",t),__postData("my_stuff",t,n)},_sxDuration)):_debug&&console.log(JSON.parse(s.responseText)))};try{s.send()}catch(e){_debug&&console.log("Error while checking data if exists."+e)}}function commitBrokerSeed(e,t){__update(_spi+"broker_seeds/"+e._key,e,t)}function commitBrokerSeeds(e,t){__ajax(_spi_aql,e,"POST",t)}function commitPropValues(e,t){__ajax(_spi+"prop_values",e,"POST",t)}function fullUrl(e){var t=document.createElement("a");return t.href=e,t.href}function __postData(a,r,i){_debug&&console.log("check if data exists.[spi.url]"+_spi+a,"[data.url]"+r.url);var c=hex_md5(r.url),u=new XMLHttpRequest;_query.collection=a,_query.example._key=c,u.open("PUT",_spi_query,!0),u.setRequestHeader("Content-Type","application/json"),u.setRequestHeader("Authorization",_auth),u.setRequestHeader("Api-Key","foobar"),u.onreadystatechange=function(){if(4===u.readyState)if(200<=u.status&&u.status<400){var e=JSON.parse(u.responseText);if(console.log("\n\ncheck result.",e,e.count),0==e.count)__create(_spi+a,r,i);else{if(r.props&&0<r.props.length){_debug&&console.log("\n\ncheck result.",e.result);var t,n=e.result[0].props||[],s={};for(t in n.forEach((e,t)=>{for(var o in console.log("foreach old props.[index]"+t,e,n),e)s[o]=e[o]}),_debug&&console.log("old props.",s),r.props.forEach((e,t)=>{for(var o in _debug&&console.log("foreach new props.[index]"+t,e,n),e)s[o]=e[o]}),_debug&&console.log("new props.",s),n=[],s){console.log("merge props.",t,s[t]);var o={};o[t]=s[t],n.push(o)}r.props=n,_debug&&console.log("commit merged props.",r)}__update(_spi+a+"/"+c,r,i)}}else _debug&&console.log(JSON.parse(u.responseText))};try{u.send(JSON.stringify(_query))}catch(e){_debug&&console.log("Error while checking data if exists."+e)}}function __create(e,t,o){_debug&&console.log("create new document against "+e,t);var n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Authorization",_auth),n.setRequestHeader("Api-Key","foobar"),n.onreadystatechange=function(){4===n.readyState&&(200<=n.status&&n.status<400&&_debug&&console.log("commit successfully. got callback",JSON.parse(n.responseText),n),o&&"function"==typeof o&&o())},n.onerror=function(e,t,o){console.log("create document error.",e,t,o)},t._key=hex_md5(t.url);var s={...JSON.parse(_meta_item),...t};console.log("try to send data.",s);try{n.send(JSON.stringify(s))}catch(e){_debug&&console.log("Error while update data to create new document."+e)}}function __update(e,t,o){_debug&&console.log("update exist document against "+e,t);var n=new XMLHttpRequest;n.open("PATCH",e,!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Authorization",_auth),n.setRequestHeader("Api-Key","foobar"),n.onreadystatechange=function(){4===n.readyState&&(200<=n.status&&n.status<400&&_debug&&console.log("commit successfully. got callback",JSON.parse(n.responseText),n),o&&"function"==typeof o&&o())},n.onerror=function(e,t,o){console.log("update document error.",e,t,o)};try{delNullProperty(t);var s={...JSON.parse(_meta_item),...t};_debug&&console.log("try to send data.",s),n.send(JSON.stringify(s))}catch(e){_debug&&console.log("Error while update data to create new document."+e)}}function queryData(e,t){__ajax(_spi_query,e,"PUT",t)}function _querySeeds(e,t){__ajax(_spi_query,e,"PUT",t)}function __postMessage(e){_debug&&console.log("try to post message to local cookie. ",e),document.getElementById("sxListFrame")&&(console.log("post message to  local cookie. ",e),document.getElementById("sxListFrame").contentWindow.postMessage({sxCookie:{action:"save",key:"sxPendingItem",value:e}},"*"))}function _next(){_querySeeds(_query_seed,function(t){var o;0<t.count?((o=t.result[0]).status="done",_debug&&console.log("now change seed status.",o),__postData("seeds",o,function(e){_debug&&console.log("change seed status done and try to redirect to next one",o),window.location.href=t.result[0].url})):_debug&&console.log("no more pending url:s")})}function __ajax(e,t,o="GET",n){_debug&&console.log("AJAX "+e,t,o);var s=new XMLHttpRequest;s.open(o,e,!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Authorization",_auth),s.setRequestHeader("Api-Key","foobar"),s.onreadystatechange=function(){4===s.readyState&&200<=s.status&&s.status<400&&n&&"function"==typeof n&&n(JSON.parse(s.responseText))};try{s.send(JSON.stringify(t))}catch(e){_debug&&console.log("AJAX error."+e)}}function _getQuery(e=window.location.search){for(var t,o,n,e=0<e.length?e.substring(1):"",s={},a=0<e.length?e.split("&"):[],r=0;r<a.length;r++)t=a[r].split("="),o=decodeURIComponent(t[0]),n=decodeURIComponent(t[1]),o.length&&(s[o]=n);return s}function delNullProperty(t){for(var o in t)if(void 0===t[o]||null===t[o]||""===t[o])delete t[o];else if(t[o].constructor===Object)0===Object.keys(t[o]).length&&delete t[o],delNullProperty(t[o]);else if(t[o].constructor===Array)if(0===t[o].length)delete t[o];else for(let e=0;e<t[o].length;e++)void 0!==t[o][e]&&null!==t[o][e]&&""!==t[o][e]&&"{}"!==JSON.stringify(t[o][e])||(t[o].splice(e,1),e--),t[o].constructor===Object&&delNullProperty(t[o])}function getSxCookie(e){console.log("got cookie.",document.cookie);for(var t=document.cookie.split(";"),o=0;o<t.length;o++){var n=e+"=";if(0==t[o].indexOf(n))return JSON.parse(t[o].substring(n.length,t[o].length))}return{}}function addSxCookie(e,t){console.log("got cookie for adding.",document.cookie);for(var o=document.cookie.split(";"),n="",s=0;s<o.length;s++){var a=e+"=";o[s].indexOf(a)<0&&(n+=o[s]+";")}n+=e+"="+JSON.stringify(t),document.cookie=n}