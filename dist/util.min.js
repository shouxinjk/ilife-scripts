var _debug=!0,_meta_item=JSON.stringify({status:{crawl:"ready",sync:"pending",load:"pending",classify:"pending",measure:"pending",evaluate:"pending",index:"pending",monitize:"pending",poetize:"pending",satisify:"pending"},timestamp:{crawl:new Date}}),_sxTimer=null,_sxDataReceived=null,_sxDuration=800,_spi="https://data.shouxinjk.net/_db/sea/_api/document/",_spi_query="https://data.shouxinjk.net/_db/sea/_api/simple/by-example",_spi_aql="https://data.shouxinjk.net/_db/sea/_api/cursor",_spi_api="https://data.shouxinjk.net/_db/sea/",_query={collection:"my_stuff",example:{_key:null}},_query_seed={collection:"seeds",example:{status:"new"},limit:1},_auth="Basic aWxpZmU6aWxpZmU=",_seeds=[];function isProduction(e){return _debug}function commitUrl(e,t){__postData("seeds",e,t)}function commitData(o,s){_sxDataReceived=_sxDataReceived||(new Date).getTime(),_sxTimer&&(new Date).getTime()-_sxDataReceived<_sxDuration&&(clearTimeout(_sxTimer),_sxTimer=null);var e=_spi_api+"category/platform_categories/mapping",t={source:o.source,name:o.category||""};_debug&&console.log("check category.[url]"+e,t);var n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){var e,t;4===n.readyState&&(200<=n.status&&n.status<400?(e=JSON.parse(n.responseText),_debug&&console.log("\n\ncheck category result.",e),e.success&&0<e.data.length&&(o.meta={category:e.data[0].mappingId,categoryName:e.data[0].mappingName},o.status={classify:"ready"},o.timestamp={classify:new Date},_debug&&console.log("\n\n data with category info.",o)),o._key=hex_md5(o.url),t={...JSON.parse(_meta_item),...o},_debug&&console.log("try to send local storage",t),__postMessage(t),_sxTimer=setTimeout(function(){console.log("trigger data commit.",t),__postData("my_stuff",t,s)},_sxDuration)):_debug&&console.log(JSON.parse(n.responseText)))};try{n.send(JSON.stringify(t))}catch(e){_debug&&console.log("Error while checking data if exists."+e)}}function commitBrokerSeed(e,t){__update(_spi+"broker_seeds/"+e._key,e,t)}function commitBrokerSeeds(e,t){__ajax(_spi_aql,e,"POST",t)}function commitPropValues(e,t){__ajax(_spi+"prop_values",e,"POST",t)}function fullUrl(e){var t=document.createElement("a");return t.href=e,t.href}function __postData(a,r,i){_debug&&console.log("check if data exists.[spi.url]"+_spi+a,"[data.url]"+r.url);var u=hex_md5(r.url),c=new XMLHttpRequest;_query.collection=a,_query.example._key=u,c.open("PUT",_spi_query,!0),c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("Authorization",_auth),c.setRequestHeader("Api-Key","foobar"),c.onreadystatechange=function(){if(4===c.readyState)if(200<=c.status&&c.status<400){var e=JSON.parse(c.responseText);if(console.log("\n\ncheck result.",e,e.count),0==e.count)__create(_spi+a,r,i);else{if(r.props&&0<r.props.length){_debug&&console.log("\n\ncheck result.",e.result);var t,s=e.result[0].props||[],n={};for(t in s.forEach((e,t)=>{for(var o in console.log("foreach old props.[index]"+t,e,s),e)n[o]=e[o]}),_debug&&console.log("old props.",n),r.props.forEach((e,t)=>{for(var o in _debug&&console.log("foreach new props.[index]"+t,e,s),e)n[o]=e[o]}),_debug&&console.log("new props.",n),s=[],n){console.log("merge props.",t,n[t]);var o={};o[t]=n[t],s.push(o)}r.props=s,_debug&&console.log("commit merged props.",r)}__update(_spi+a+"/"+u,r,i)}}else _debug&&console.log(JSON.parse(c.responseText))};try{c.send(JSON.stringify(_query))}catch(e){_debug&&console.log("Error while checking data if exists."+e)}}function __create(e,t,o){_debug&&console.log("create new document against "+e,t);var s=new XMLHttpRequest;s.open("POST",e,!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Authorization",_auth),s.setRequestHeader("Api-Key","foobar"),s.onreadystatechange=function(){4===s.readyState&&(200<=s.status&&s.status<400&&_debug&&console.log("commit successfully. got callback",JSON.parse(s.responseText),s),o&&"function"==typeof o&&o())},t._key=hex_md5(t.url);var n={...JSON.parse(_meta_item),...t};console.log("try to send data.",n);try{s.send(JSON.stringify(n))}catch(e){_debug&&console.log("Error while update data to create new document."+e)}}function __update(e,t,o){_debug&&console.log("update exist document against "+e,t);var s=new XMLHttpRequest;s.open("PATCH",e,!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Authorization",_auth),s.setRequestHeader("Api-Key","foobar"),s.onreadystatechange=function(){4===s.readyState&&(200<=s.status&&s.status<400&&_debug&&console.log("commit successfully. got callback",JSON.parse(s.responseText),s),o&&"function"==typeof o&&o())};try{delNullProperty(t);var n={...JSON.parse(_meta_item),...t};_debug&&console.log("try to send data.",n),s.send(JSON.stringify(n))}catch(e){_debug&&console.log("Error while update data to create new document."+e)}}function queryData(e,t){__ajax(_spi_query,e,"PUT",t)}function _querySeeds(e,t){__ajax(_spi_query,e,"PUT",t)}function __postMessage(e){_debug&&console.log("try to post message to local cookie. ",e),document.getElementById("sxListFrame")&&(console.log("post message to  local cookie. ",e),document.getElementById("sxListFrame").contentWindow.postMessage({sxCookie:{action:"save",key:"sxPendingItem",value:e}},"*"))}function _next(){_querySeeds(_query_seed,function(t){var o;0<t.count?((o=t.result[0]).status="done",_debug&&console.log("now change seed status.",o),__postData("seeds",o,function(e){_debug&&console.log("change seed status done and try to redirect to next one",o),window.location.href=t.result[0].url})):_debug&&console.log("no more pending url:s")})}function __ajax(e,t,o="GET",s){_debug&&console.log("AJAX "+e,t,o);var n=new XMLHttpRequest;n.open(o,e,!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Authorization",_auth),n.setRequestHeader("Api-Key","foobar"),n.onreadystatechange=function(){4===n.readyState&&200<=n.status&&n.status<400&&s&&"function"==typeof s&&s(JSON.parse(n.responseText))};try{n.send(JSON.stringify(t))}catch(e){_debug&&console.log("AJAX error."+e)}}function _getQuery(e=window.location.search){for(var t,o,s,e=0<e.length?e.substring(1):"",n={},a=0<e.length?e.split("&"):[],r=0;r<a.length;r++)t=a[r].split("="),o=decodeURIComponent(t[0]),s=decodeURIComponent(t[1]),o.length&&(n[o]=s);return n}function delNullProperty(t){for(var o in t)if(void 0===t[o]||null===t[o]||""===t[o])delete t[o];else if(t[o].constructor===Object)0===Object.keys(t[o]).length&&delete t[o],delNullProperty(t[o]);else if(t[o].constructor===Array)if(0===t[o].length)delete t[o];else for(let e=0;e<t[o].length;e++)void 0!==t[o][e]&&null!==t[o][e]&&""!==t[o][e]&&"{}"!==JSON.stringify(t[o][e])||(t[o].splice(e,1),e--),t[o].constructor===Object&&delNullProperty(t[o])}